// src/handlers.rs
//! Top-level handler dispatcher. Keeps behavior identical while delegating to smaller modules.

use anyhow::Result;
use crossterm::event::KeyEvent;

pub mod handlers_internal {
    pub use crate::handlers::delete;
    pub use crate::handlers::edit;
    pub use crate::handlers::inventory;
    pub use crate::handlers::navigation;
    pub use crate::handlers::new_item;
    pub use crate::handlers::search;
    pub use crate::handlers::selection;
    pub use crate::handlers::util;
    
    // New modules
    pub use crate::handlers::create;
    pub use crate::handlers::select;
    pub use crate::handlers::normal;
}

pub fn handle_input(app: &mut crate::app::App, key: KeyEvent) -> Result<()> {
    // Priority order: specific modes first, then general navigation
    
    // Edit modes (highest priority)
    if handlers_internal::edit::handle(app, key)? {
        return Ok(());
    }
    
    // Create modes
    if handlers_internal::create::handle(app, key)? {
        return Ok(());
    }
    
    // Selection modes
    if handlers_internal::select::handle(app, key)? {
        return Ok(());
    }
    
    // Delete modes
    if handlers_internal::delete::handle(app, key)? {
        return Ok(());
    }
    
    // New item creation (tag/material/category)
    if handlers_internal::new_item::handle(app, key)? {
        return Ok(());
    }
    
    // Normal mode navigation
    if handlers_internal::normal::handle(app, key)? {
        return Ok(());
    }
    
    // Search and inventory (fallback)
    if handlers_internal::search::handle(app, key)? {
        return Ok(());
    }
    if handlers_internal::inventory::handle(app, key)? {
        return Ok(());
    }
    
    // Global navigation (Esc, etc.)
    if handlers_internal::navigation::handle(app, key)? {
        return Ok(());
    }
    
    // Utilities (Ctrl+o folder open)
    if handlers_internal::util::handle(app, key)? {
        return Ok(());
    }
    
    // Not handled here.
    Ok(())
}
